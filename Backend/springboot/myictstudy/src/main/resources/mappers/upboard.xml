<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.ictedu.myictstudy.dao.UpBoardDao">

	<insert id="add" parameterType="upvo">
	 	insert into upboard values(upboard_seq.nextVal,#{title},
	 			#{writer},#{content},#{imgn},0,#{reip},sysdate)
	</insert>

<!--	<select id="list" resultType="upvo">-->
<!--	 	select * from upboard order by 1 desc-->
<!--	</select>-->
	<!--
			searchType=1:writer,2:title,3:content
			searchValue="검색값"
	-->
	<select id="list" resultType="upvo" parameterType="map">
		SELECT num,TITLE,writer,content,hit,reip,bdate,imgn, row_num
		FROM (
		SELECT num,TITLE,writer,content,hit,reip,bdate,imgn,
		ROW_NUMBER() OVER(ORDER BY num desc) AS row_num FROM upboard
		
		<if test="searchType != null and searchValue != null">
			<where>
				<choose>
					<when test="searchType == 1">
						writer like '%'|| #{searchValue} ||'%'
					</when>
					<when test="searchType == 2">
						title like '%'|| #{searchValue} ||'%'
					</when>
					<when test="searchType == 3">
						content like '%'|| #{searchValue} ||'%'
					</when>
				</choose>
			</where>
		</if>
		
		) numbered_rows WHERE row_num BETWEEN #{begin} AND #{end}
	
	</select>
	<select id="totalCount" resultType="int" parameterType="map">
			select count(*) cnt from upboard
		<if test="searchType != null and searchValue != null">
			<where>
				<choose>
					<when test="searchType == 1">
						writer like '%'|| #{searchValue} ||'%'
					</when>
					<when test="searchType == 2">
						title like '%'|| #{searchValue} ||'%'
					</when>
					<when test="searchType == 3">
						content like '%'|| #{searchValue} ||'%'
					</when>
				</choose>
			</where>
		</if>
	</select>
	
	
 	<update id="hit" parameterType="int">
 		update upboard set hit=hit+1 where num=#{num}
 	</update>
 	<select id="detail" parameterType="int" resultType="upvo">
 		select * from upboard where num=#{num}
 	</select>
 	<delete id="delete" parameterType="int">
 		delete from upboard where num=#{num}
 	</delete>














</mapper>





